<div class="container">
  <ng-container *ngIf="location$ | async as location; else loadingOrError">
    <h1>{{ location.name }}</h1>
    <h2 *ngIf="location.dimension">Dimension: {{ location.dimension }}</h2>
    <h2 *ngIf="!location.dimension && location.type">Type: {{ location.type }}</h2>

    <div class="details">
      <div class="info">
         <h2>Location Information</h2>
         <ul>
           <li *ngIf="location.type"><strong>Type:</strong> {{ location.type }}</li>
           <li><strong>Dimension:</strong> {{ location.dimension || 'Unknown' }}</li>
           <li><strong>Resident Count:</strong> {{ location.residents?.length || 0 }}</li>
         </ul>
       </div>
    </div>

    <div class="residents-section" *ngIf="location.residents && location.residents.length > 0">
      <h2>Residents</h2>
      <ul>
        <li *ngFor="let residentUrl of location.residents">
          <ng-container *ngIf="getCharacterId(residentUrl) as charId">
             <a [routerLink]="['/characters', charId]">
               Character {{ charId }}
             </a>
          </ng-container>
          <ng-container *ngIf="!getCharacterId(residentUrl)">
            <span>Invalid Resident Link</span>
          </ng-container>
        </li>
      </ul>
    </div>
    <div *ngIf="!location.residents || location.residents.length === 0" class="no-results">
      <p>There are no known residents recorded for this location.</p>
    </div>



  </ng-container> <ng-template #loadingOrError>
    <div *ngIf="loadingError" class="error-message">
      <p>Could not load location details. The location may not exist or there was a network error.</p>
    </div>
    <div *ngIf="!loadingError" class="loading-container">
      <p>Loading location details...</p>
      <div class="loader"></div>
    </div>
  </ng-template>
</div>
